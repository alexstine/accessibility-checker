!function($){"use strict";$((function(){!function(t){var e,n,i=window.location.search.substring(1).split("&");for(n=0;n<i.length;n++)if((e=i[n].split("="))[0]===t)return void 0===e[1]||decodeURIComponent(e[1])}("edac");edac_script_vars.loggedIn}))}(jQuery);class EdacHighlight{constructor(){this.nextButton=document.querySelector("#edac-highlight-next"),this.previousButton=document.querySelector("#edac-highlight-previous"),this.panelToggle=document.querySelector("#edac-highlight-panel-toggle"),this.currentButtonIndex=0,this.init()}init(){this.nextButton.addEventListener("click",(()=>this.highlightFocusNext())),this.previousButton.addEventListener("click",(()=>this.highlightFocusPrevious())),this.panelToggle.addEventListener("click",(()=>this.panelOpen()))}findElement(t){const e=t.object,n=(new DOMParser).parseFromString(e,"text/html");console.log(n);const i=n.body.firstElementChild;if(!i)return null;const o=document.body.querySelectorAll("*");for(const e of o)if(e.outerHTML===i.outerHTML)return this.wrapElement(e,t),this.addTooltip(e,t),e;return null}highlightAjax(){const t=new XMLHttpRequest,e=edac_script_vars.ajaxurl+"?action=edac_frontend_highlight_ajax&post_id="+edac_script_vars.postID+"&nonce="+edac_script_vars.nonce;t.open("GET",e),t.onload=function(){if(200===t.status){const e=JSON.parse(t.responseText);if(!0===e.success){let t=JSON.parse(e.data);console.log(t),t.forEach(function(t,e){const n=this.findElement(t);console.log(n)}.bind(this))}else console.log(e)}else console.log("Request failed.  Returned status of "+t.status)}.bind(this),t.send()}wrapElement(t,e){const n=t.parentNode,i=document.createElement("div");i.className=`edac-highlight edac-highlight-${e.rule_type}`,n.insertBefore(i,t),i.appendChild(t)}addTooltip(t,e){const n=`\n\t\t\t<button class="edac-highlight-btn edac-highlight-btn-${e.ruletype}"\n\t\t\t\t\taria-label="${e.rule_title}"\n\t\t\t\t\taria-expanded="false"\n\t\t\t\t\taria-controls="edac-highlight-tooltip-${e.id}"></button>\n\t\t`;t.insertAdjacentHTML("beforebegin",n)}highlightFocusNext(){const t=document.querySelectorAll(".edac-highlight-btn");this.currentButtonIndex=(this.currentButtonIndex+1)%t.length,t[this.currentButtonIndex].focus(),console.log("Visible: "+this.isElementVisible(t[this.currentButtonIndex])),console.log("Hidden: "+this.isElementHidden(t[this.currentButtonIndex]))}highlightFocusPrevious(){const t=document.querySelectorAll(".edac-highlight-btn");this.currentButtonIndex=(this.currentButtonIndex-1+t.length)%t.length,t[this.currentButtonIndex].focus()}isElementVisible(t){const e=t.getBoundingClientRect(),n=window.innerHeight||document.documentElement.clientHeight,i=window.innerWidth||document.documentElement.clientWidth;return e.top>=0&&e.left>=0&&e.bottom<=n&&e.right<=i}isElementHidden(t){return"none"===window.getComputedStyle(t).display}panelOpen(){document.querySelector("#edac-highlight-panel-controls").style.display="block",this.panelToggle.style.display="none",this.highlightAjax()}}window.addEventListener("DOMContentLoaded",(()=>{new EdacHighlight}));